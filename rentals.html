<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aircraft Rentals</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f7fafc; }
    header { background: #3182ce; color: white; padding: 1rem; text-align: center; }
    #listings { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
      gap: 1rem; 
      padding: 1rem; 
    }
    .card {
      background: white; 
      border-radius: 8px; 
      overflow: hidden; 
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex; 
      flex-direction: column;
    }
    .card img {
      width: 100%; 
      height: 160px; 
      object-fit: cover;
    }
    .card-content {
      padding: 0.75rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .card-title { font-size: 1.1rem; font-weight: bold; margin: 0.5rem 0 0.25rem; }
    .card-sub { font-size: 0.9rem; color: #4a5568; margin-bottom: 0.5rem; }
    .card-desc { font-size: 0.85rem; color: #718096; flex: 1; }
    .card-footer { margin-top: 0.5rem; font-size: 0.9rem; }
  </style>
</head>
<body>

  <header>
    <h1>Aircraft Rental Marketplace</h1>
  </header>

  <div id="listings">
    <!-- Cards will be injected here -->
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // 1. Import the functions you need from the SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import {
      getFirestore, collection, query, where, orderBy, getDocs
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // 2. Your web app's Firebase configuration (replace with your config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // 3. Initialize Firebase & Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 4. Fetch listings and render
    async function loadListings() {
      const listingsContainer = document.getElementById('listings');
      const q = query(
        collection(db, 'airplanes'),
        where('isListed', '==', true),
        orderBy('createdAt', 'desc')
      );
      try {
        const snapshot = await getDocs(q);
        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          // Parse aircraftModel like in your RN code
          const [year="", make="", ...rest] = (data.aircraftModel||"").split(' ');
          const model = rest.join(' ') || 'Unknown Model';
          const imgUrl = Array.isArray(data.images) ? data.images[0] : data.images;
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <img src="${imgUrl || 'https://via.placeholder.com/300x160?text=No+Image'}" alt="Aircraft image">
            <div class="card-content">
              <div class="card-title">${year} ${make}</div>
              <div class="card-sub">${model}</div>
              <div class="card-sub">Location: ${data.location||'Unknown'}</div>
              <div class="card-footer">${parseFloat(data.costPerHour||0).toFixed(2)}/hr</div>
              <div class="card-desc">${(data.description||'No description').split(' ').slice(0,10).join(' ')}${(data.description||'').split(' ').length>10?'â€¦':''}</div>
            </div>
          `;
          listingsContainer.appendChild(card);
        });
        if (snapshot.empty) {
          listingsContainer.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#718096;">No listings available</p>';
        }
      } catch (err) {
        console.error('Error loading listings:', err);
        listingsContainer.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#e53e3e;">Failed to load listings.</p>';
      }
    }

    // 5. Kick it off
    loadListings();
  </script>
</body>
</html>
